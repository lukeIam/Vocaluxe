language: csharp
solution: Vocaluxe.sln
env:
  matrix:
  - config=Linux platform=x64
  - config=Linux platform=x86
branches:
  except:
  - Nightly
before_install:
  - sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF
  - sudo echo "deb http://download.mono-project.com/repo/ubuntu stable-trusty main" | tee /etc/apt/sources.list.d/mono-official-stable.list
  - sudo apt-get update -qq
  - sudo apt-get install -y mono-complete
  - chmod ugo+x ./.build/linuxPostBuildEvent.sh
  - chmod ugo+x ./.build/linuxPreBuildEvent.sh
  - chmod ugo+x ./.travis/gitDescribe.sh
  - chmod ugo+x ./.travis/installFFmpeg.sh
  - wget https://dist.nuget.org/win-x86-commandline/latest/nuget.exe -P ./.travis/
  - sudo ./.travis/installFFmpeg.sh
script:
- ./.travis/gitDescribe.sh
- mono ./.travis/nuget.exe restore
- make -C PitchTracker
- make -C Vocaluxe/Lib/Video/Acinerella
- msbuild /p:Configuration=Release$config /p:Platform=$platform /p:TargetFrameworkVersion=v4.7 Vocaluxe.sln
before_deploy:
- chmod ugo+x ./.travis/packArtifact.sh
- "./.travis/packArtifact.sh"
#- chmod ugo+x ./.travis/moveTagForSpecialBranches.sh
#- "./.travis/moveTagForSpecialBranches.sh"
deploy:
  provider: releases
  api_key: $GITHUB_KEY
  file: build/Vocaluxe_$GIT_TAG_$config_$platform.zip
  skip_cleanup: true
  on:
    repo: lukeIam/Vocaluxe
    tags: true
